<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Building neural nets in Minecraft |


  Ashutosh  Sathe

</title>
<meta name="description" content="Personal webpage of Ashutosh Sathe 
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.xyz/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘‹</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/blog/2020/minecraft-neural-nets/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163324683-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-163324683-1');
</script>




    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <span class="font-weight-bold">Ashutosh</span>   Sathe
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Building neural nets in Minecraft</h1>
    <p class="post-meta">May 6, 2020</p>
  </header>

  <article class="post-content">
    <p>This blog explains my thoughts behind creation of my project called <a href="https://github.com/ashutoshbsathe/scarpet-nn">scarpet-nn</a> which allows you to implement binarized neural nets in Minecraft.</p>

<p>I think neural network in Minecraft is a cool idea because it opens us to so many new possibilities in-game. Think of custom maps where mapmakers can hide a secret passage or rooms which are accessible only when you draw certain pattern on a wall and the in-game neural network recognizing it ! We can have games where each stage completion computes output of a layer of your neural network and so if you complete the  stages in wrong order, you obviously get wrong answers. We can have a multiplayer game where one team modifies the neural network activations to change the output of neural network while the other team changes the weights of the neural network to make sure output does not change. More than this, I think just visualizing the neural network calculating results block by block in Minecraft would be very satisfying to watch too !</p>

<h2 id="am-i-the-first-to-think-of-this-">Am I the first to think of this ?</h2>

<p>No, ofcourse not. <em>Thereâ€™s always someone who has thought of the same thing before you (ALWAYS)</em></p>

<p>On some quick googling, I found an implementation of an <a href="https://www.reddit.com/r/Minecraft/comments/ak22ur/neural_network_for_handwritten_digit_recognition/">MNIST ConvNet in Minecraft</a>. It was decently fast, but required a ton of memory, wasnâ€™t server friendly at all and used more than 2 million (!!!) command blocks to implement it. This meant that if some custom map creator wanted to use this in their server, they would need compute comparable to a dedicated data center to run the server smoothly. Moreover, it also doesnâ€™t offer us flexibility to reconfigure the neural network, which means if you wanted to implement some new neural network, you would need to rewrite/regenerate all those millions of command blocks. Plus, there is no nice block-by-block visualization possibilities in this.</p>

<h2 id="design">Design</h2>

<p>I decided to limit my scope for implementing only conv and fully connected layers (for now). These layers are easy to implement since they only need multiplication and addition operations. My initial idea was to take a CPU designed in Minecraft (such as this <a href="https://www.youtube.com/watch?v=5Fwy4jUJUoM">amazing 32 bit FPU</a>), take a memory designed in Minecraft (like <a href="https://www.youtube.com/watch?v=7NaWSnlcr8w">this video</a>), connect them using some redstone <em>magic</em> and then finally build a redstone circuit that properly reads the model from memory, executes it and stores the result back in memory.</p>

<p>However, this was a hell lot more tedious than I initially imagined. The design of memory wasnâ€™t fully scalable, this would mean that users would need to rewire the memory to CPU which isnâ€™t exactly nice considering design principles. But most importantly, the FPU or CPU just wasnâ€™t fast enough. Each operation on that CPU or FPU took about 1.5-2s to calculate on my decently fast CPU. This was obvious due to limited in-game capabilities. Note when I rant about 1.5-2s for computing answer using the FPU, itâ€™s only in context of neural networks because they have thousands of these operations. From an electrical engineering standpoint, the <a href="https://www.youtube.com/watch?v=5Fwy4jUJUoM">FPU</a> I am referring to is very elegantly designed.</p>

<p>So after this I thought of quantization of neural network weights to use less bits to represent each number in weights and activations of the nerual net. Better yet, I opted for <a href="https://arxiv.org/abs/1602.02830">binarized neural networks</a>. These use only a single bit for representing every number in computation of neural networks. Because of this, multiplication and addition operations become a lot easier.</p>

<h3 id="binarized-multiplication">Binarized Multiplication</h3>
<p>Following table describes the multiplication of 2 weights or activations when binarized to +1 or -1.</p>

<table width="100%">
<thead>
<tr>
<th style="text-align:center">$$A$$</th>
<th style="text-align:center">$$B$$</th>
<th style="text-align:center">$$C = A * B$$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-1</td>
<td style="text-align:center">-1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">-1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">-1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">-1</td>
<td style="text-align:center">-1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>

<!--
| $$A$$| $$B$$  | $$C = A * B$$ |
| :---: | :---: | :---------: |
| -1 | -1 | 1         |
| -1 | 1  | -1        |
| 1  | -1 |  -1       |
| 1  | 1  | 1         |
-->

<p>In bit representation, this multiplication resembles XNOR gate.</p>

<table width="100%">
<thead>
<tr>
<th style="text-align:center">$$A$$</th>
<th style="text-align:center">$$B$$</th>
<th style="text-align:center">$$C = A * B$$</th>
<th style="text-align:center">$$C =\overline{A \oplus B}$$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>

<!--
| $$A$$  | $$B$$  | $$C = A * B$$ | $$C = \overline{A \oplus B}$$ |
| :---: | :---: | :---------: | :---: |
| 0 | 0 | 1         | 1 |
| 0 | 1  | 0        | 0 |
| 1  | 0 |  0       | 0 |
| 1  | 1  | 1         | 1 |
-->

<p>This means that, in BNNs multiplication operation reduces to simple XNOR as opposed to <a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic#Multiplication_and_division">complicated floating point multiplication algorithm</a>. We can do XNOR operation in Minecraft as follows: (based on <a href="https://www.youtube.com/watch?v=DR9BwuaPPH4">this very compact design</a>)</p>

<center>
<img src="/files/blog_assets/neural-nets-in-minecraft/redstone-xnor-minecraft.png" alt="redstone xnor minecraft" width="100%" />
</center>

<h3 id="binarized-reduceaddition">Binarized Reduce/Addition</h3>
<p>Reduce operation typically refers to adding up all elements of a tensor along some specific direction. In case of BNNs, since all the operands are either +1 or -1, we only need sign of the answer as the output of reduction operation. In bit representation, this translates to bitcounting operation. Therefore, to reduce a vector of length \(l\) of 1s and 0s, we only need to count number of 1s in the vector in some variable say <code class="language-plaintext highlighter-rouge">bitcount</code>. Then, output of reduction operation is bit <code class="language-plaintext highlighter-rouge">1</code> (+1) if \((bitcount \geq l/2)\) and bit <code class="language-plaintext highlighter-rouge">0</code>(-1) otherwise.</p>

<p>I couldnâ€™t find a Minecraft version of this so I decided to design my own as follows:</p>

<center>
<img src="/files/blog_assets/neural-nets-in-minecraft/redstone-reducer-minecraft.png" alt="redstone reducer minecraft" width="100%" />
</center>

<p>This reducer architecture unfortunately <strong>cannot work for more than 16 bits</strong>. That being said Iâ€™m not a big redstone guy and I canâ€™t even make a 4x4 flush piston door without looking up a tutorial. Maybe someone with deeper understanding of redstone mechanics can do a much better job at this.</p>

<h2 id="scarpet---a-programming-language-in-minecraft">Scarpet - A programming language <em>in</em> Minecraft</h2>
<p>While the reducer I designed will work for small neural networks (only 3x3 conv filters, not more than 16 in any dimension etc.), I wanted to support more general and bigger neural networks. Scarpet is an in-game, functional-like programming language developed by <a href="https://github.com/gnembon">gnembon</a>. While scarpet requires <a href="https://github.com/gnembon/fabric-carpet">carpetmod</a> (which means our neural networks wonâ€™t be pure vanilla Minecraft-y), it is an excellent choice for building neural nets because it is server friendly and has a nifty <a href="https://github.com/gnembon/fabric-carpet/blob/master/docs/scarpet/Full.md#game_tickmstime"><code class="language-plaintext highlighter-rouge">game_tick()</code></a> function. <a href="https://github.com/gnembon/fabric-carpet/blob/master/docs/scarpet/Full.md#game_tickmstime"><code class="language-plaintext highlighter-rouge">game_tick()</code></a> allows you to essentially pause the game for specified amount of time. This means our block by block visualization requirement is also fulfilled. <a href="https://github.com/ashutoshbsathe">gnembon</a> does an excellent job at explaining the language with the <a href="https://github.com/gnembon/fabric-carpet/blob/master/docs/scarpet/Full.md">documentation of scarpet</a>.</p>

<h2 id="representation-of-neural-nets">Representation of Neural Nets</h2>
<p>With scarpet as our tool, we need to focus on representating binarized neural networks in Minecraft. We can set 2 different blocks for representing \(+1\) and \(-1\) in weights/activations. Moreover, I also thought it would be nice to be able to convert my PyTorch binarized neural network into my Minecraft representation. Therefore, I decided to generate a <a href="https://github.com/maruohon/litematica">litematica</a> schematic for every layer of my neural network. Litematica allows you to put a schematic of block arrangements anywhere in the world, this schematic is extremely handy to recreate the block arrangement in the world.</p>

<p>This means we need a program that can take in our PyTorch model and output a litematica schematic (the <code class="language-plaintext highlighter-rouge">.litematica</code> file) for every layer for us to build in our world. Unfortunately, the <code class="language-plaintext highlighter-rouge">.litematica</code> format isnâ€™t very well documented. Thankfully with the help of the developer <a href="https://github.com/maruohon">maruohon</a> and the <a href="https://pypi.org/project/nbtlib/">NBT data exploration library</a> I was able to write to the <code class="language-plaintext highlighter-rouge">.litematica</code> file properly. The code for this module is available in the <a href="https://github.com/ashutoshbsathe/scarpet-nn/tree/master/nn-to-litematica">nn-to-litematica</a> folder on my <a href="https://github.com/ashutoshbsathe/scarpet-nn">scarpet-nn</a> repo. (note that <a href="https://github.com/ashutoshbsathe/scarpet-nn/tree/master/nn-to-litematica">nn-to-litematica</a> currently supports only conv and fc layers without bias)</p>

<p>I have written more about the litematica schematic generation rules in the <a href="https://ashutoshbsathe.github.io/scarpet-nn/nn-to-litematica/">documentation of scarpet-nn</a>. With this much progress, it was just a matter of time to write some neat, modularized code for scarpet apps that implement our intended functionality.</p>

<h2 id="results">Results</h2>
<p>After fixing up a representation, I was able to build and run the neural network in my Minecraft world. But it was extremely boring to modify input block by block. To solve this, I decided to write a scarpet app called <a href="https://github.com/ashutoshbsathe/scarpet-nn/blob/master/scarpet-apps/drawingboard.sc"><code class="language-plaintext highlighter-rouge">drawingboard</code></a> that lets you draw at the input layer by right clicking on it with any sword. I implemented a small binary image classifier that could detect digits <code class="language-plaintext highlighter-rouge">0</code> and <code class="language-plaintext highlighter-rouge">1</code> from the <a href="http://yann.lecun.com/exdb/mnist/">MNIST dataset</a>.</p>

<p>See the working classifier demo:</p>
<div class="yt-iframe-container">
<iframe src="https://www.youtube.com/embed/LVmOcAYbYdU" frameborder="0" allowfullscreen="" class="yt-iframe-video"></iframe>
</div>

<hr />

<p>Block by block visualization</p>
<div class="yt-iframe-container">
<iframe src="https://www.youtube.com/embed/KEcUKpBTk8M" frameborder="0" allowfullscreen="" class="yt-iframe-video"></iframe>
</div>

<p><br /><br /></p>

<p>So this is where I end my blog. Feel free to reach me for suggestions/comments/questions/your own neural networks built in Minecraft. I would love to hear from you!</p>

  </article>

  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2021 Ashutosh  Sathe.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  
<!-- Enable Tooltips -->
<script type="text/javascript">
$(function () {$('[data-toggle="tooltip"]').tooltip()})
</script>



<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
